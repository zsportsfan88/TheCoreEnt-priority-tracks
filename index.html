<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Core Entertainment - Priority Tracks Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root { 
            --gold: #C5A059; 
            --gold-grad: linear-gradient(145deg, #f3d082, #a17d3a);
            --bg: #000000; --sidebar: #0f0f0f; --border: #222222; --text: #fff; --muted: #888; 
        }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar & Branding */
        aside { width: 280px; background: var(--sidebar); border-right: 1px solid var(--border); padding: 30px 20px; display: flex; flex-direction: column; }
        .brand-logo { 
            cursor: pointer; font-size: 1.4rem; font-weight: 900; letter-spacing: 2px; text-transform: uppercase;
            background: var(--gold-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            border-bottom: 2px solid #a17d3a; padding-bottom: 15px; margin-bottom: 25px;
        }
        .nav-scroll { flex: 1; overflow-y: auto; }
        ul { list-style: none; padding: 0; }
        li { padding: 10px 15px; cursor: pointer; border-radius: 4px; font-size: 0.85rem; color: var(--muted); transition: 0.2s; }
        li:hover { color: #fff; background: #1a1a1a; }
        li.active { color: #fff; border: 1px solid var(--gold); background: #111; font-weight: bold; }
        .show-all-btn { width: 100%; padding: 12px; background: transparent; border: 1px solid var(--gold); color: var(--gold); border-radius: 4px; cursor: pointer; margin-top: 15px; font-weight: bold; text-transform: uppercase; }

        /* Main View */
        main { flex: 1; display: flex; flex-direction: column; background: #050505; }
        .header { padding: 20px 40px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .toggle-container { display: flex; background: #111; padding: 4px; border-radius: 8px; margin-left: 20px; }
        .toggle-btn { padding: 8px 20px; border: none; background: transparent; color: var(--muted); border-radius: 6px; cursor: pointer; font-size: 0.75rem; font-weight: bold; }
        .toggle-btn.active { background: var(--gold-grad); color: #000; }

        /* Table Mechanics */
        .content { padding: 20px 40px; overflow-y: auto; flex: 1; }
        table { width: 100%; border-collapse: separate; border-spacing: 0 6px; min-width: 1600px; table-layout: fixed; }
        th { text-align: left; padding: 12px; color: var(--gold); font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; position: sticky; top: 0; background: #050505; z-index: 10; }
        td { padding: 12px; background: #0f0f0f; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); font-size: 0.8rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        /* Column Widths */
        .col-song { width: 250px; } /* Fixed width for song names */
        .col-artist { width: 150px; }
        .col-date { width: 120px; }
        .col-stat { width: 100px; text-align: center; }

        /* Logic Coloring */
        .heat-cell { font-weight: bold; color: #000 !important; }
        .status-pill { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; }
    </style>
</head>
<body>

<aside>
    <div class="brand-logo" onclick="clearFilter()">THE CORE</div>
    <div class="nav-scroll"><ul id="artist-list"></ul></div>
    <button class="show-all-btn" onclick="clearFilter()">Show All Roster</button>
</aside>

<main>
    <div class="header">
        <h2 id="view-title" style="margin:0; font-size: 1.3rem;">Priority Tracks Dashboard</h2>
        <div class="toggle-container">
            <button id="btn-released" class="toggle-btn active" onclick="setMode('released')">RELEASED</button>
            <button id="btn-unreleased" class="toggle-btn" onclick="setMode('unreleased')">UNRELEASED</button>
        </div>
        <input type="text" id="global-search" class="search-bar" placeholder="Filter track names..." style="background:#111; border:1px solid #222; color:#fff; padding:8px 15px; border-radius:4px; outline:none;">
    </div>

    <div class="content"><div id="table-output"></div></div>
</main>

<script>
const MASTER_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTp-yQVU_VNNOR5aXQ7m-Xv7BiAgYKjBfJuT6lIETy6ksjqR-Lj2WW4DNqYGCNX2rfCpUtemiS1shes/pub?gid=2070907343&single=true&output=csv';

let allMasterData = [];
let currentArtistFilter = null;
let currentMode = 'released'; // 'released' or 'unreleased'

const EXCEPTIONS = ["Nate Smith", "Josh Ross", "Dax"];

function setMode(mode) {
    currentMode = mode;
    document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('btn-' + mode).classList.add('active');
    renderTable();
}

function clearFilter() {
    currentArtistFilter = null;
    document.querySelectorAll('li').forEach(l => l.classList.remove('active'));
    document.getElementById('view-title').innerText = "Priority Tracks Dashboard";
    renderTable();
}

function getAoColor(val) {
    let n = parseFloat(val) || 0;
    if (n >= 20) return 'background:#1DB954;';
    if (n <= 10) return 'background:#ff4444;';
    return 'background:#444; color:#fff !important;';
}

function getAqColor(val) {
    let n = parseFloat(val) || 0;
    if (n >= 40) return 'background:#1DB954;';
    if (n < 20) return 'background:#ff4444;';
    return 'background:#444; color:#fff !important;';
}

function renderTable() {
    const search = document.getElementById('global-search').value.toLowerCase();
    const today = new Date();

    let filtered = allMasterData.filter(row => {
        const artist = row[0];
        const releaseDateStr = row[3] || "";
        const releaseDate = new Date(releaseDateStr);
        const isException = EXCEPTIONS.includes(artist);
        
        // 1. Basic Cleaning
        if (row[32]?.includes("#DIV/0")) return false;
        if (!releaseDateStr || releaseDateStr.toLowerCase().includes("tbd")) return false;

        // 2. Year/Exception Filter
        const year = releaseDate.getFullYear();
        if (year < 2025 && !isException) return false;

        // 3. Released vs Unreleased Filter
        if (currentMode === 'released' && releaseDate > today) return false;
        if (currentMode === 'unreleased' && releaseDate <= today) return false;

        // 4. Artist/Search Filter
        const artistMatch = currentArtistFilter ? artist === currentArtistFilter : true;
        const searchMatch = row[1].toLowerCase().includes(search);
        return artistMatch && searchMatch;
    });

    let html = `<table><thead><tr>
        <th class="col-song">Track Title</th><th class="col-artist">Artist</th><th>1st Post</th>
        <th class="col-stat">Pre-Posts (AO)</th><th class="col-date">Release</th>
        <th>1st Wk Str</th><th>Avg Wk Str</th><th class="col-stat">Total Posts (AQ)</th>
        <th>Avg Views</th><th>Eng %</th><th>Total UGC</th>
    </tr></thead><tbody>`;

    filtered.forEach(row => {
        html += `<tr>
            <td title="${row[1]}" style="color:var(--gold); font-weight:bold;">${row[1]}</td>
            <td style="color:#aaa; font-size:11px;">${row[0]}</td>
            <td>${row[2] || '-'}</td>
            <td class="heat-cell" style="${getAoColor(row[40])}">${row[40] || '0'}</td>
            <td style="font-weight:bold;">${row[3]}</td>
            <td>${row[6] || '-'}</td>
            <td>${row[9] || '-'}</td>
            <td class="heat-cell" style="${getAqColor(row[42])}">${row[42] || '0'}</td>
            <td>${row[11] || '-'}</td>
            <td>${row[32] || '-'}</td>
            <td>${row[36] || '-'}</td>
        </tr>`;
    });

    document.getElementById('table-output').innerHTML = html + `</tbody></table>`;
}

function init() {
    Papa.parse(MASTER_CSV_URL, {
        download: true,
        header: false,
        complete: (results) => {
            allMasterData = results.data.filter(r => r[0] && r[0] !== "ARTIST");
            const artists = [...new Set(allMasterData.map(r => r[0]))].sort();
            const list = document.getElementById('artist-list');
            artists.forEach(name => {
                const li = document.createElement('li');
                li.innerText = name;
                li.onclick = () => {
                    document.querySelectorAll('li').forEach(el => el.classList.remove('active'));
                    li.classList.add('active');
                    currentArtistFilter = name;
                    document.getElementById('view-title').innerText = name;
                    renderTable();
                };
                list.appendChild(li);
            });
            renderTable();
        }
    });
    document.getElementById('global-search').oninput = renderTable;
}
init();
</script>
</body>
</html>
